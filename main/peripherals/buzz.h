#pragma once
#include <driver/ledc.h>
#include <freertos/FreeRTOS.h>
#include <freertos/task.h>
#include "esp_log.h"

#define BUZZER_TAG "Buzzer"

//PWM library for buzzer, adapted from ESP32-C3 Components Demo on DTU Learn Line 56-62 in example_main.c
#define BUZZ_TIMER              LEDC_TIMER_1
#define BUZZ_MODE               LEDC_LOW_SPEED_MODE
#define BUZZ_CHANNEL            LEDC_CHANNEL_4
#define BUZZ_DUTY_RES           LEDC_TIMER_13_BIT // Set duty resolution to 13 bits
#define BUZZ_DUTY               (4096) // Set duty to 50%. (2 ** 13) * 50% = 4096
#define BUZZ_FREQUENCY          (1000) // Frequency in Hertz. Set frequency at 1 kHz



// Different Notes for songs
//C4 = 244Hz
#define NOTE_C4 244


typedef struct {
    int gpio_num;

    ledc_timer_config_t ledc_timer_buzz;
    ledc_channel_config_t ledc_channel_buzz;
} buzz_config_t;

esp_err_t init_buzzer(buzz_config_t *config);
void all();
void play_note(int hz, int period);
void pause_note(int period);
void play_song(int *notes);

void song_task(void *pvParameters);

static const int funMarch[] = {300, 523, 1082, 50, 311, 1082, 50, 391, 1082, 50, 130, 1082, 50, 523, 810, 50, 311, 1082, 50, 415, 1082, 50, 103, 1082, 50, 587, 271, 50, 97, 1082, 50, 493, 2165, 50, 293, 2165, 50, 391, 2165, 50, 97, 1082, 50, 130, 543, 50, 523, 1082, 50, 311, 1082, 50, 391, 1082, 50, 116, 543, 50, 103, 543, 50, 523, 810, 50, 311, 1082, 50, 415, 1082, 50, 97, 543, 50, 587, 271, 50, 622, 1082, 50, 349, 1082, 50, 415, 1082, 50, 523, 1082, 50, 87, 1082, 50, 587, 1082, 50, 391, 1082, 50, 493, 1082, 50, 97, 1082, 50, 523, 1082, 50, 311, 1082, 50, 391, 1082, 50, 130, 1082, 50, 523, 810, 50, 311, 1082, 50, 415, 1082, 50, 103, 1082, 50, 587, 271, 50, 97, 1082, 50, 493, 2165, 50, 293, 2165, 50, 391, 2165, 50, 97, 1082, 50, 130, 543, 50, 523, 1082, 50, 311, 1082, 50, 391, 1082, 50, 97, 543, 50, 87, 543, 50, 587, 810, 50, 349, 1082, 50, 415, 1082, 50, 77, 543, 50, 622, 271, 50, 698, 1082, 50, 415, 1082, 50, 523, 1082, 50, 73, 1082, 50, 622, 810, 50, 391, 1082, 50, 493, 1082, 50, 97, 1082, 50, 587, 271, 50, 523, 1082, 50, 311, 1082, 50, 415, 1082, 50, 103, 1082, 50, 103, 543, 50, 523, 810, 50, 311, 1082, 50, 415, 1082, 50, 97, 543, 50, 587, 271, 50, 523, 1082, 50, 349, 1082, 50, 415, 1082, 50, 87, 1082, 50, 523, 810, 50, 349, 1082, 50, 415, 1082, 50, 87, 1082, 50, 587, 271, 50, 523, 1082, 50, 311, 1082, 50, 391, 1082, 50, 97, 1082, 50, 97, 543, 50, 523, 810, 50, 311, 1082, 50, 391, 1082, 50, 103, 543, 50, 587, 271, 50, 493, 1082, 50, 293, 1082, 50, 391, 1082, 50 };
static const int doom[] = {300, 82, 136, 20, 82, 136, 20, 164, 136, 20, 82, 136, 20, 82, 136, 20, 146, 136, 20, 82, 136, 20, 82, 136, 20, 130, 136, 20, 82, 136, 20, 82, 136, 20, 82, 136, 272, 116, 272, 20, 123, 136, 272, 82, 272, 20, 130, 136, 20, 82, 136, 20, 82, 136, 20, 164, 136, 20, 82, 136, 20, 82, 136, 20, 146, 136, 20, 82, 136, 20, 82, 136, 20, 130, 136, 20, 82, 136, 20, 82, 545, 409, 116, 545, 20, 82, 136, 20, 82, 136, 20, 164, 136, 20, 82, 136, 20, 82, 136, 20, 146, 136, 20, 82, 136, 20, 82, 136, 20, 130, 136, 20, 82, 136, 20, 82, 136, 20, 116, 136, 20, 82, 136, 20, 123, 136, 272, 82, 272, 20, 130, 136, 20, 82, 136, 20, 82, 136, 20, 164, 136, 20, 82, 136, 20, 82, 136, 20, 146, 136, 20, 82, 136, 20, 82, 136, 20, 130, 136, 20, 82, 136, 20, 82, 545, 409, 116, 545, 20, 82, 136, 20, 82, 136, 20, 164, 136, 20, 82, 136, 20, 82, 136, 20, 146, 136, 20, 82, 136, 20, 82, 136, 20, 130, 136, 20, 82, 136, 20, 82, 136, 20, 82, 136, 272, 116, 272, 20, 123, 136, 272, 82, 272, 20, 130, 136, 20, 82, 136, 20, 82, 136, 20, 164, 136, 20, 82, 136, 20, 82, 136, 20, 146, 136, 20, 82, 136, 20, 82, 136, 20, 130, 136, 20, 82, 136, 20, 82, 545, 409, 116, 545, 20, 82, 136, 20, 82, 136, 20, 164, 136, 20, 82, 136, 20, 82, 136, 20, 146, 136, 20, 82, 136, 20, 82, 136, 20, 130, 136, 20, 82, 136, 20, 82, 136, 20, 82, 136, 272, 116, 272, 20, 123, 136, 272, 82, 272, 20, 130, 136, 1};
static const int mario[] = {300, 659, 123, 50, 523, 123, 50, 659, 248, 50, 523, 248, 50, 659, 123, 50, 523, 123, 50, 523, 123, 50, 659, 123, 50, 783, 248, 50, 493, 248, 50, 391, 248, 50, 246, 248, 50, 523, 248, 50, 391, 248, 50, 329, 248, 50, 440, 248, 50, 493, 248, 50, 466, 123, 50, 440, 123, 50, 391, 165, 50, 659, 165, 50, 783, 165, 50, 880, 248, 50, 698, 123, 50, 783, 123, 50, 659, 248, 50, 523, 123, 50, 587, 123, 50, 493, 123, 50, 523, 248, 50, 391, 248, 50, 329, 248, 50, 440, 248, 50, 493, 248, 50, 466, 123, 50, 440, 123, 50, 391, 165, 50, 659, 165, 50, 783, 165, 50, 880, 248, 50, 698, 123, 50, 783, 123, 50, 659, 248, 50, 523, 123, 50, 587, 123, 50, 493, 123, 50, 261, 123, 50, 783, 123, 50, 739, 123, 50, 698, 123, 50, 622, 123, 50, 659, 123, 50, 523, 123, 50, 415, 123, 50, 440, 123, 50, 523, 123, 50, 440, 123, 50, 523, 123, 50, 587, 123, 50, 261, 123, 50, 783, 123, 50, 739, 123, 50, 698, 123, 50, 622, 123, 50, 659, 123, 50, 523, 123, 50, 1046, 123, 50, 659, 123, 50, 1046, 123, 50, 659, 123, 50, 1046, 123, 50, 659, 123, 50, 391, 123, 50, 261, 123, 50, 783, 123, 50, 739, 123, 50, 698, 123, 50, 622, 123, 50, 659, 123, 50, 523, 123, 50, 415, 123, 50, 440, 123, 50, 523, 123, 50, 440, 123, 50, 523, 123, 50, 587, 123, 50, 622, 123, 50, 415, 123, 50, 587, 123, 50, 391, 123, 50, 523, 123, 50, 329, 123, 50, 391, 123, 50, 391, 123, 50, 261, 123, 50, 261, 123, 50, 783, 123, 50, 739, 123, 50, 698, 123, 50, 622, 123, 10};